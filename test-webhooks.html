<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webhook Test - Marceau Solutions</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
</head>
<body class="bg-black text-white">
    <div class="container py-5">
        <h1 class="text-gold text-center mb-5">üß™ Webhook Testing Dashboard</h1>

        <div class="row g-4">
            <!-- Test Lead Submission -->
            <div class="col-md-6">
                <div class="card">
                    <h3>üìù Test Lead Submission</h3>
                    <p>Test the /api/leads/submit endpoint</p>
                    <button class="btn btn-gold" onclick="testLeadSubmission()">Test Lead Submission</button>
                    <div id="lead-result" class="output-area mt-3" style="display:none;"></div>
                </div>
            </div>

            <!-- Test SMS Opt-In -->
            <div class="col-md-6">
                <div class="card">
                    <h3>üì± Test SMS Opt-In</h3>
                    <p>Test the /api/sms/optin endpoint</p>
                    <input type="tel" id="testPhone" class="form-control mb-2" placeholder="Your phone number" value="">
                    <button class="btn btn-gold" onclick="testSMSOptIn()">Test SMS Welcome</button>
                    <div id="sms-result" class="output-area mt-3" style="display:none;"></div>
                </div>
            </div>

            <!-- Test Email Opt-In -->
            <div class="col-md-6">
                <div class="card">
                    <h3>üìß Test Email Opt-In</h3>
                    <p>Test the /api/email/optin endpoint</p>
                    <input type="email" id="testEmail" class="form-control mb-2" placeholder="Your email" value="">
                    <button class="btn btn-gold" onclick="testEmailOptIn()">Test Welcome Email</button>
                    <div id="email-result" class="output-area mt-3" style="display:none;"></div>
                </div>
            </div>

            <!-- API Status -->
            <div class="col-md-6">
                <div class="card">
                    <h3>üîç API Status</h3>
                    <p>Check backend health and dependencies</p>
                    <button class="btn btn-gold" onclick="checkAPIStatus()">Check Status</button>
                    <div id="status-result" class="output-area mt-3" style="display:none;"></div>
                </div>
            </div>

            <!-- Complete Form Test -->
            <div class="col-12">
                <div class="card">
                    <h3>üéØ Full Workflow Test</h3>
                    <p>Test the complete lead capture workflow (all endpoints)</p>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <input type="text" id="fullFirstName" class="form-control" placeholder="First Name" value="Test">
                        </div>
                        <div class="col-md-6">
                            <input type="text" id="fullLastName" class="form-control" placeholder="Last Name" value="User">
                        </div>
                        <div class="col-12">
                            <input type="text" id="fullBusiness" class="form-control" placeholder="Business Name" value="Test Fitness Co">
                        </div>
                        <div class="col-md-6">
                            <input type="email" id="fullEmail" class="form-control" placeholder="Email" value="">
                        </div>
                        <div class="col-md-6">
                            <input type="tel" id="fullPhone" class="form-control" placeholder="Phone" value="">
                        </div>
                        <div class="col-12">
                            <textarea id="fullProject" class="form-control" rows="3" placeholder="Project Description">Testing the lead capture workflow to ensure all webhooks are working correctly.</textarea>
                        </div>
                        <div class="col-12">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="fullSMS" checked>
                                <label class="form-check-label" for="fullSMS">Test SMS opt-in</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="fullEmail" checked>
                                <label class="form-check-label" for="fullEmail">Test Email opt-in</label>
                            </div>
                        </div>
                        <div class="col-12">
                            <button class="btn btn-gold btn-lg w-100" onclick="testFullWorkflow()">üöÄ Test Complete Workflow</button>
                        </div>
                    </div>
                    <div id="full-result" class="output-area mt-3" style="display:none;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://web-production-44ade.up.railway.app';

        async function testLeadSubmission() {
            const resultDiv = document.getElementById('lead-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="spinner-border text-warning"></div> Testing...';

            try {
                const response = await fetch(`${API_URL}/api/leads/submit`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        firstName: 'Test',
                        lastName: 'User',
                        businessName: 'Test Fitness Co',
                        email: 'test@example.com',
                        phone: '(555) 123-4567',
                        projectDescription: 'Testing lead submission webhook',
                        smsOptIn: false,
                        emailOptIn: false,
                        termsAgreement: true,
                        timestamp: new Date().toISOString(),
                        source: 'webhook-test'
                    })
                });

                const data = await response.json();

                if (data.success) {
                    resultDiv.innerHTML = `<div class="text-success">‚úÖ Success!</div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>`;
                } else {
                    resultDiv.innerHTML = `<div class="text-warning">‚ö†Ô∏è Partial Success</div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="text-danger">‚ùå Error: ${error.message}</div>`;
            }
        }

        async function testSMSOptIn() {
            const phone = document.getElementById('testPhone').value;
            if (!phone) {
                alert('Please enter your phone number');
                return;
            }

            const resultDiv = document.getElementById('sms-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="spinner-border text-warning"></div> Sending SMS...';

            try {
                const response = await fetch(`${API_URL}/api/sms/optin`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        phone: phone,
                        firstName: 'Test',
                        lastName: 'User',
                        timestamp: new Date().toISOString()
                    })
                });

                const data = await response.json();

                if (data.success) {
                    resultDiv.innerHTML = `<div class="text-success">‚úÖ SMS sent! Check your phone.</div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>`;
                } else {
                    resultDiv.innerHTML = `<div class="text-warning">‚ö†Ô∏è SMS not configured or failed</div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="text-danger">‚ùå Error: ${error.message}</div>`;
            }
        }

        async function testEmailOptIn() {
            const email = document.getElementById('testEmail').value;
            if (!email) {
                alert('Please enter your email');
                return;
            }

            const resultDiv = document.getElementById('email-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="spinner-border text-warning"></div> Sending email...';

            try {
                const response = await fetch(`${API_URL}/api/email/optin`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: email,
                        firstName: 'Test',
                        lastName: 'User',
                        businessName: 'Test Fitness Co',
                        timestamp: new Date().toISOString()
                    })
                });

                const data = await response.json();

                if (data.success) {
                    resultDiv.innerHTML = `<div class="text-success">‚úÖ Email sent! Check your inbox.</div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>`;
                } else {
                    resultDiv.innerHTML = `<div class="text-warning">‚ö†Ô∏è Email not configured or failed</div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="text-danger">‚ùå Error: ${error.message}</div>`;
            }
        }

        async function checkAPIStatus() {
            const resultDiv = document.getElementById('status-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="spinner-border text-warning"></div> Checking...';

            try {
                const response = await fetch(`${API_URL}/api/status`);
                const data = await response.json();

                resultDiv.innerHTML = `<div class="text-success">‚úÖ API Online</div>
                    <pre>${JSON.stringify(data, null, 2)}</pre>`;
            } catch (error) {
                resultDiv.innerHTML = `<div class="text-danger">‚ùå API Offline: ${error.message}</div>`;
            }
        }

        async function testFullWorkflow() {
            const resultDiv = document.getElementById('full-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="spinner-border text-warning"></div> Running full workflow test...';

            const formData = {
                firstName: document.getElementById('fullFirstName').value,
                lastName: document.getElementById('fullLastName').value,
                businessName: document.getElementById('fullBusiness').value,
                email: document.getElementById('fullEmail').value,
                phone: document.getElementById('fullPhone').value,
                projectDescription: document.getElementById('fullProject').value,
                smsOptIn: document.getElementById('fullSMS').checked,
                emailOptIn: document.getElementById('fullEmail').checked,
                termsAgreement: true,
                timestamp: new Date().toISOString(),
                source: 'full-workflow-test'
            };

            let results = [];

            try {
                // Test 1: Lead Submission
                results.push('<h5 class="text-gold">1. Lead Submission</h5>');
                const leadRes = await fetch(`${API_URL}/api/leads/submit`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                const leadData = await leadRes.json();
                results.push(`<div class="${leadData.success ? 'text-success' : 'text-warning'}">
                    ${leadData.success ? '‚úÖ' : '‚ö†Ô∏è'} ${leadData.message}
                </div>`);

                // Test 2: SMS Opt-In (if checked)
                if (formData.smsOptIn && formData.phone) {
                    results.push('<h5 class="text-gold mt-3">2. SMS Opt-In</h5>');
                    const smsRes = await fetch(`${API_URL}/api/sms/optin`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            phone: formData.phone,
                            firstName: formData.firstName,
                            lastName: formData.lastName,
                            timestamp: formData.timestamp
                        })
                    });
                    const smsData = await smsRes.json();
                    results.push(`<div class="${smsData.success ? 'text-success' : 'text-warning'}">
                        ${smsData.success ? '‚úÖ' : '‚ö†Ô∏è'} ${smsData.message}
                    </div>`);
                }

                // Test 3: Email Opt-In (if checked)
                if (formData.emailOptIn && formData.email) {
                    results.push('<h5 class="text-gold mt-3">3. Email Opt-In</h5>');
                    const emailRes = await fetch(`${API_URL}/api/email/optin`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            email: formData.email,
                            firstName: formData.firstName,
                            lastName: formData.lastName,
                            businessName: formData.businessName,
                            timestamp: formData.timestamp
                        })
                    });
                    const emailData = await emailRes.json();
                    results.push(`<div class="${emailData.success ? 'text-success' : 'text-warning'}">
                        ${emailData.success ? '‚úÖ' : '‚ö†Ô∏è'} ${emailData.message}
                    </div>`);
                }

                results.push('<h5 class="text-success mt-4">üéâ Workflow Complete!</h5>');
                results.push('<p>Check your Google Sheet, phone, and email for results.</p>');

                resultDiv.innerHTML = results.join('');

            } catch (error) {
                resultDiv.innerHTML = `<div class="text-danger">‚ùå Error: ${error.message}</div>`;
            }
        }

        // Auto-check API status on load
        window.addEventListener('load', checkAPIStatus);
    </script>

    <style>
        .output-area {
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 16px;
            color: #fff;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .output-area pre {
            margin: 0;
            color: #FFD700;
        }
    </style>
</body>
</html>
